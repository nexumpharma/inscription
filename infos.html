<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Infos utilisateur</title>
  <link rel="stylesheet" href="css/style.css">

  <!-- Charger Supabase d'abord -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <!-- Puis ton script -->
  <script src="js/auth.js"></script>
</head>
<body>
  <h1>Bienvenue</h1>
  <div id="status">Chargement...</div>
  <div id="metadata"></div>

  <script>
    async function showUserMetadata() {
      await checkAndRestoreSessionFromURL();

      const { data: { user }, error } = await supabaseClient.auth.getUser();
      const status = document.getElementById('status');
      const metadataDiv = document.getElementById('metadata');

      if (!user) {
        status.textContent = "❌ Vous n'êtes pas connecté.";
        return;
      }

      status.innerHTML = `✅ Connecté en tant que <strong>${user.email}</strong>`;

      const metadata = user.user_metadata;

      if (!metadata || Object.keys(metadata).length === 0) {
        metadataDiv.textContent = "Aucune donnée utilisateur trouvée.";
        return;
      }

      metadataDiv.innerHTML = "<h2>Données reçues :</h2><ul>" +
        Object.entries(metadata).map(([key, value]) => `<li><strong>${key}</strong> : ${value}</li>`).join("") +
        "</ul>";
    }

    showUserMetadata();
  </script>
</body>
</html>
