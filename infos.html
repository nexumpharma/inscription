<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Infos utilisateur</title>
  <link rel="stylesheet" href="css/style.css">

  <!-- Charger la biblioth√®que Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>Bienvenue</h1>
  <div id="status">Chargement...</div>
  <div id="metadata"></div>

  <script>
    // üîê Configuration
    const SUPABASE_URL = "https://nywocoxkfdrsscvnvjas.supabase.co";
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55d29jb3hrZmRyc3Njdm52amFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY4OTA1MDgsImV4cCI6MjA2MjQ2NjUwOH0.Gj2TOFLghSlztKgZiUzrdnntH5oNPKs8RALG8fGvSm4';    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function checkAndRestoreSessionFromURL() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      const access_token = params.get("access_token");
      const refresh_token = params.get("refresh_token");

      if (access_token && refresh_token) {
        await supabase.auth.setSession({ access_token, refresh_token });
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }

    async function showUserMetadata() {
      await checkAndRestoreSessionFromURL();

      const { data: { user } } = await supabase.auth.getUser();
      const status = document.getElementById("status");
      const metadataDiv = document.getElementById("metadata");

      if (!user) {
        status.textContent = "‚ùå Vous n'√™tes pas connect√©.";
        return;
      }

      status.innerHTML = `‚úÖ Connect√© en tant que <strong>${user.email}</strong>`;

      const metadata = user.user_metadata;
      if (!metadata || Object.keys(metadata).length === 0) {
        metadataDiv.textContent = "Aucune donn√©e utilisateur trouv√©e.";
        return;
      }

      metadataDiv.innerHTML = "<h2>Donn√©es re√ßues :</h2><ul>" +
        Object.entries(metadata).map(([key, value]) =>
          `<li><strong>${key}</strong> : ${value}</li>`).join("") +
        "</ul>";
    }

    showUserMetadata();
  </script>
</body>
</html>
