<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Infos utilisateur</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Charger Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <!-- Script d’authentification -->
  <script src="js/auth.js"></script>
</head>
<body>
  <h1>Bienvenue</h1>
  <div id="status">Chargement...</div>
  <button onclick="logout()" style="margin: 1rem 0;">Se déconnecter</button>
  <h2>Données Supabase (user_metadata)</h2>
  <div id="metadata"></div>

  <h2>Paramètres de l’URL</h2>
  <div id="urlparams"></div>

  <script>
    async function showUserDataAndURLParams() {
      const urlParams = await checkAndRestoreSessionFromURL();

      // Affiche les paramètres d'URL
      const urlDiv = document.getElementById("urlparams");
      urlDiv.innerHTML = "<ul>" + Array.from(urlParams.entries())
        .map(([k, v]) => `<li><strong>${k}</strong> : ${v}</li>`).join("") + "</ul>";

      const { data: { user } } = await supabase.auth.getUser();
      const status = document.getElementById("status");
      const metadataDiv = document.getElementById("metadata");

      if (!user) {
        status.textContent = "❌ Vous n'êtes pas connecté.";
        return;
      }

      status.innerHTML = `✅ Connecté en tant que <strong>${user.email}</strong>`;

      const metadata = user.user_metadata;
      if (!metadata || Object.keys(metadata).length === 0) {
        metadataDiv.textContent = "Aucune donnée utilisateur trouvée.";
        return;
      }

      metadataDiv.innerHTML = "<ul>" +
        Object.entries(metadata).map(([key, value]) =>
          `<li><strong>${key}</strong> : ${value}</li>`).join("") +
        "</ul>";
    }

    showUserDataAndURLParams();
  </script>
</body>
</html>
